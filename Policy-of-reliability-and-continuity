Политика настройки серверов и обеспечения отказоустойчивости
Ver 0.0.1
Евгений Литюшкин
evgeny.lityushkin@gmail.com
GNU Free Documentation License





Москва 2017
Назначение

Целью настоящей политики является определение требований к архитектуре, порядку внесения изменений, системам управления конфигурациями, методам хранения конфигураций, настройкам и именованию серверов, рабочих станций и иного активного оборудования в целях обеспечения непрерывного функционирования информационных систем Компании.
Область действия 

Положения настоящей политики распространяются на всех работников Компании. 
Порядок актуализации и внесения изменений

Настоящая  политика подлежит периодической актуализации не реже одного раза в год. При возникновении необходимости актуализация может производиться чаще. Результатом актуализации является утверждение новой редакции.  Предложения по актуализации и внесению изменений могут быть выдвинуты любым работником Компании. Внесённые предложения подлежат согласованию с  лицами, ответственными за эксплуатацию информационных систем компании и подлежат обязательному утверждению  руководителем отдела системного администрирования. 
Общие принципы
    Все информационные системы компании должны быть учтены и известны руководителю отдела системного администрирования.  
За каждой системой закрепляется ответственный системный администратор и его заместитель. Далее в данном документе именуемые “операторы”. Оператору назначаются, допускаются к выполнению плановых работ, освобождаются от обязанностей руководителем отдела системного администрирования. 
В том случае если существуют особые требования к параметрам доступности, надёжности, сохранности обрабатываемой в данной информационной системе информации - они должны быть доведены до сведения и известны руководителю отдела системного администрирования и операторам.
Соглашения с клиентами Компании относительно уровня оказания услуг, далее в данном документе - SLA, соглашения о конфиденциальности и/или сохранности обрабатываемой информации должны быть доведены и известны руководителю отдела системного администрирования и операторам.
Перечень информационных систем компании, ответственных системных администраторов пересматривается не реже одного раза в год или по необходимости.
Наименование и маркировка серверов

Все сервера, рабочие станции и любое активное оборудование  должно быть названо уникальными именами. 
Названия рабочих станций должно формироваться из фамилии и инициалов пользователя написанных латинскими буквами.
Название серверов должно состоять из названия проекта, стадии, роли и номера при необходимости, разделёнными тире.
Название активного должно состоять из сокращения типа оборудования, стадии, роли или географического местонахождения и номера, при  необходимости, разделённых тире.
Стадии бывают:

Prod - оборудование прямо используемое в производстве, оказании услуг и предоставлении сервисов предоставляемых клиентам компании или жизненно-важных для компании;
Preprod - оборудование на котором отрабатываются настройки и программное обеспечение непосредственно перед внедрением в prod;
Test  - оборудование на котором производится тестирования программного обеспечения и настроек;
Stable - оборудование на котором отрабатываются настройки и программное обеспечение непосредственно перед переносом на preprod;
Satge - стенды для испытания новых технических решений, систем, настроек или программного обеспечения;
Dev - оборудование на котором происходит разработка нового программного обеспечения.

Примеры:

Ortax-stage-nginx1

Проект - ortax,  стадия - stage,  сервер - nginx, номер - 1.

Bet-prod-mysql4

Проект - Bet, стадия prod, сервер MySql или MariaDB, номер 4.

Appollo-prod-haproxy2

Проект - Appollo, стадия prod, сервер haproxy, номер 2.

    Приглашение для ввода команд должно отображать название оборудования.
    Обои рабочего стола должны отображать название сервера.
    Приглашение для ввода команд в Prod среде должно быть красного цвета.
    Приглашение для ввода команд в Preprod среде должно быть жёлтого цвета.
    Приглашение для ввода команд в Test среде должно быть синего цвета.
    Приглашение для ввода команд в Stable среде должно быть синего цвета.
    Приглашение для ввода команд в Stage среде должно быть зелёного цвета.
Приглашение для ввода команд в Dev среде должно быть зелёного цвета.    

Цвет рабочего стола серверов в Prod среде  должно быть красного цвета.
Цвет рабочего стола серверов в Preprod среде  должно быть жёлтого цвета.
Цвет рабочего стола серверов в Test среде  должно быть синего цвета.
Цвет рабочего стола серверов в Stable среде  должно быть синего цвета.
Цвет рабочего стола серверов в Stage среде  должно быть зелёного цвета.
Цвет рабочего стола серверов в Dev среде  должно быть зелёного цвета.

Названия оборудования должны быть нанесены на лицевые панели устройств, системные блоки рабочих станций и серверов.
























Хранение конфигураций

    Конфигурационные файлы, шаблоны файлов и параметры хранятся в системе контроля версий git.
    Конфигурации для разных стадий должны хранится в разных branches. Названия branch должно соответствовать названию стадии.
    Название commit должно содержать однозначную ссылку и описание решаемой задачи.
Системы управления конфигурациями

    Все плановые изменения  настроек вносятся при помощи систем управления конфигурациями.  Ручное изменение настроек допускается только в исключительных случаях когда системы управления конфигурациями не могут быть применены по техническим причинам.
    Системы управления конфигурациями должны быть настроены таким образом чтобы, было возможно внесение изменений только в одну стадию.
    Запрещается внесение плановых изменений одновременно в “синее” и “зелёное” плечо кластера.
    Перед внесением изменений в конфигурационные файлы должна быть создана его резервная копия с тем же именем и с постфиксом old.
    Перед применением Ansible Playbook следует проверить перечень узлов к которым он будет применён запустив его с ключём --list-hosts (пример):

ansible-playbook -i fron/inventory nginx.yml --list-hosts

Также следует проверить список выполняемых задач с помощью ключа --list-tasks (пример):

ansible-playbook -i fron/inventory nginx.yml --list-tasks

Одновременное внесения плановых изменений в узлы находящиеся в различных (физических) центрах обработки данных не допускается.
    
    Внесение однотипных изменений более чем в 2 узла одновременно не допускается.  На первом шаге следует внести изменение в 1 узел.  Проверить корректность работы узла и системы в целом. В случае отсутствия ошибок и проблем в работе системы и узла допускается внесение изменение в 2n узлов с последующей проверкой корректности работы системы и узлов. Описанные действия повторяются до момента применения изменений ко всем узлам для которых они предназначены.
Порядок внесение изменений

    Изменения бывают плановыми и аварийными. Плановые изменения вносятся только в нормально функционирующие системы.  Перед внесением плановых изменений разрабатываются, согласуются и утверждаются “план внесения изменений”. 
    Внедрение новых информационных систем или их программных или аппаратных компонентов относится к числу плановых изменений.
    Аварийные изменения вносятся исходя из разумной целесообразности в целях устранения аварии и минимизации её последствий.
    
    План внесения изменений должен включать в себя:

Описание исходного состояния системы;
Описание методов резервного копирования данных перед внесением изменений;
Описание методов проверки созданных резервных копий;
Пошаговой инструкции по внесению изменений;
Описания контрольных точек в которых производится проверка корректности вносимых изменений;
Описания методов проверки корректности вносимых изменений в контрольных точках;
Описание методов отката от контрольных точек к исходному состоянию в случае обнаружения некорректности вносимых изменений;
Описания финального состояния;
Описание методов проверки того, что система приведена в финальное состояние;
Даты и времени внесения изменений.

Плановые изменения в Prod стадию вносятся только в случае если система:

Подвергается мониторингу;
Корректно работает;
Соответствует описанному в плане внесения изменений исходному состоянию;
План внесения изменений соответствуют указанным в данном документе требованиям и полностью понятен исполнителю;
Планируемые изменения успешно применены и не приводят к ошибкам на Test и Preprod стадиях.

    Непосредственно внесение изменение в системы стадии Prod допускается только после прямого и недвусмысленное разрешения от уполномоченных работников Компании в заранее согласованное время и дату.



Требования к психофизическому состоянию оператора
    Оператор осуществляющий применение плановых изменений должен быть здоров и находится в спокойном психологическом состоянии.
    В день перед внесением изменений он должен проспать не менее 8 часов. Если иное не утверждено в SLA или соглашение с клиентом, плановые изменения вносятся в рабочее время в период с 9-00 до 12-00 по местному времени.
    В случае проведения работ в ночное время - с 21-00 до 8-00 по местному времени оператор освобождается от выполнения своих обязанностей на следующий рабочий день.
    Оператор обязан своевременно (до начала работ по внесению изменений) сообщать руководителю отдела системного администрирования  сведения о состоянии своего здоровья и психологическом состоянии.
Ответственным за допуск оператора к работе является руководитель отдела системного администрирования.

Мониторинг
    Все сервера Prod стадии должны находится под постоянным мониторингом.  Рабочие станции и иное активное оборудование подвергается мониторингу при наличии технической возможности.
    Список параметров подлежащих мониторингу согласуется операторами информационных систем и утверждается руководителем отдела системного администрирования.
    Время хранения информации в системе мониторинга не менее недели, согласуется операторами информационных систем и утверждается руководителем отдела системного администрирования.
    Все операторы должны иметь круглосуточный удаленный доступ к системе мониторинга.
    Система мониторинга должна обнаруживать отказы в работе аппаратных средств, недоступность каналов связи, сбои в работе операционной системы и систем управления баз данных приводящие к невозможности нормальной работы информационных систем.
    Информация о вышеуказанных сбоях и отказах должна доводится до всех операторов при помощи sms.
    Ответственные операторы не менее одного раза в неделю должны на основании исторических данных анализировать тенденции в поисках возможных проблем в работе информационных систем,  тенденции к исчерпанию ресурсов и сообщать о возможных опасностях руководителю отдела системного администрирования.
 
    
Проверки резервности
    Все кластера Prod стадии построенные по принципу “активный-пассивный узлы” (master-slave) должны не реже одного раза в три месяца переключатся, активный узел должен становится пассивным и наоборот.
    
Резервное копирование
    Резервные копии Prod стадии должны обязательно проверяться.
    Резервные копии данных Prod стадии должны создаваться ежесуточно.  
Время хранения данных Prod стадии не менее месяца, согласуется ответственными операторами и утверждается руководителем отдела системного администрирования.
Все кластера систем управления базами данных Prod стадии построенные по принципу “активный-пассивный узлы” (master-slave) должны иметь не менее двух (2-ух) пассивных/ведомых узлов.

Требования к архитектуре
    
    Все сервера и узлы стадии Prod дублируются. Точки одного отказа быть не должно.
    Все сервера и узлы находятся под мониторингом. Потеря резервности вызывает оповещение системных администраторов.
    Не должно быть возможности одновременного внесения изменений в различные стадии;
    Стадия Preprod полностью тождественна по всем параметрам стадии Prod.
    Не должно быть возможности обращения к данным Prod стадии кроме явно разрешённых.
Все сервера в стадиях prod, preprod, объединены в “сине-зелёный кластер”. 
Иное активное оборудование и сервера иных стадий также могут быть объединены в “сине-зелёный кластер” (к цветовым настройкам приглашения командной строки и рабочих столов данное обозначение отношения не имеет).
Сервера и активное оборудование с нечётными номерами считается находящимся в “синем” плече, с чётными в “зелёном” плече.
Если иное не определено отдельно, в иных случаях сервера и оборудование считаются находящимися в “зелёном” плече.


